var userEntity = require('./../models/UserEntity');var userDao = require('./../models/UserDao');var gridFS = require('./../models/GridFS');var qs = require('querystring');var path = require('path');var fs = require('fs');var sys = require("sys");var user = exports;user.login = function (request, response){	response.view("login.html", {}, {});};user.register = function (request, response){	response.view("register.html", {}, {});};user.add = function (request, response){	var user = Object.create(userEntity.UserEntity);	//var user = {};	user["username"] = request.post["username"];	user["password"] = request.post["password"];	user["email"] = request.post["email"];	user["post"] = 0;	user["reply"] = 0;	//用户类型:1表示普通用户，2表示版主，3表示管理员	user["type"] = 1;	//用户状态: 0表示离线， 1表示在线	user["status"] = 0;	var date = new Date();	var now = date.toISOString();	user["regtime"] = now;	user["logtime"] = now;		var cb1 = function (){		response.redirect("/eslab/index/home");	};	var cb2 = function (){		response.send("User exist!");	};	userDao.add({"username":request.post["username"]}, user, cb1, cb2);};user.processlogin = function (request, response){	var user = {};	user["username"] = request.post["username"];	user["password"] = request.post["password"];		var cb1 = function (){		response.setHeader('Set-Cookie', ['sid='+user["username"]+';path=/eslab']);		response.redirect("/eslab/index/home");	};	var cb2 = function (){		response.setHeader('Set-Cookie', ['sid=null;path=/eslab']);		response.send("Login failure!");	};		userDao.login(user, cb1, cb2);};user.processlogout = function (request, response){	var cookies = qs.parse(request.headers.cookie,';');		var user = {};	user["username"] = cookies['sid'];		var cb1 = function (){		response.setHeader('Set-Cookie', ['sid=null;path=/eslab']);		response.redirect("/eslab/index/home");	};	var cb2 = function (){		response.send("Logout failure!");	};		userDao.logout(user, cb1, cb2);};